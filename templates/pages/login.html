{% extends "pages/base.html" %}
{% block title %}ASR Gateway | Login{% endblock %}
{% block content %}
<section style="display:grid; place-items:center; padding:48px 0;">
  <div class="panel" style="width:min(420px, 100%);">
    <div class="stack">
      <div class="badge">Welcome back</div>
      <h2 style="margin:0;">Login to ASR Gateway</h2>
      <p class="muted">Access your dashboard, applications, and recorder.</p>
      <label for="username">Username</label>
      <input id="username" placeholder="you@example.com" autocomplete="username">
      <label for="password">Password</label>
      <input id="password" type="password" placeholder="••••••••" autocomplete="current-password">
      <button id="btnLogin" class="btn" style="width:100%;">Login</button>
      <div id="loginError" class="muted" style="color:#f87171; display:none;"></div>
      <p class="muted" style="text-align:center;">No account? <a href="/register/" style="color:var(--primary);">Create one</a></p>
    </div>
  </div>
</section>

<script>
  const csrftoken = document.querySelector('meta[name="csrf-token"]').content;
  const errorBox = document.getElementById("loginError");
  document.getElementById("btnLogin").onclick = async () => {
    errorBox.style.display = "none";
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();
    if (!username || !password) {
      errorBox.textContent = "Please enter username and password.";
      errorBox.style.display = "block";
      return;
    }
    const res = await fetch("/api/auth/token/", {
      method:"POST",
      headers: {"Content-Type":"application/json", "X-CSRFToken": csrftoken},
      body: JSON.stringify({username, password})
    });
    const data = await res.json();
    if (!res.ok || !data.access) {
      errorBox.textContent = data.detail || "Invalid credentials.";
      errorBox.style.display = "block";
      return;
    }
    Auth.setToken(data.access);
    window.location = "/dashboard/";
  };
</script>
{% endblock %}
